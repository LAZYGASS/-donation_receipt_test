# 구글 설문지 응답 자동 PDF 생성 및 메일 전송 시스템

구글 설문지를 통해 수집된 응답 데이터를 자동으로 PDF 문서로 변환하고, 응답자에게 메일로 전송하는 완전 자동화 시스템입니다.

## 🎯 주요 기능

- **자동 체크박스 생성**: 새로운 설문 응답이 접수되면 J열에 체크박스 자동 생성
- **트리거 기반 자동화**: 체크박스 체크 시 자동으로 PDF 생성 및 메일 발송 시작
- **데이터 매핑**: 설문 응답 데이터를 문서 시트의 지정된 위치에 자동 매핑
- **PDF 생성**: 문서 시트를 기반으로 PDF 파일 자동 생성
- **메일 발송**: 생성된 PDF를 응답자 이메일로 자동 발송
- **상태 관리**: 실시간 진행 상황 모니터링 및 오류 처리

## 📋 시트 구조

### 설문지 응답 시트1
```
A열: 타임스탬프
B열: 기타 응답 데이터
C열: 응답자 정보1 → 문서 C8
D열: 응답자 정보2 → 문서 H8  
E열: 응답자 이메일 (메일 발송용)
F열: 응답자 정보3 → 문서 C9
G-H열: 기타 응답 데이터
I열: 금액 → 문서 J24 (관리자가 수동 입력)
J열: 체크박스 (트리거 역할)
K열: PDF 저장 상태
L열: 메일 전송 상태
```

## 🚀 설치 및 설정

### 1. Google Apps Script 프로젝트 생성
1. [Google Apps Script](https://script.google.com) 접속
2. 새 프로젝트 생성
3. `Code.js` 파일의 내용을 복사하여 붙여넣기

### 2. 스프레드시트 연결
1. Google Sheets에서 설문지와 연결된 스프레드시트 열기
2. Apps Script에서 `리소스 > 라이브러리` 선택
3. 스프레드시트 ID 입력하여 연결

### 3. 권한 설정
다음 API 권한이 필요합니다:
- `https://www.googleapis.com/auth/spreadsheets` (시트 읽기/쓰기)
- `https://www.googleapis.com/auth/drive.file` (파일 저장)
- `https://www.googleapis.com/auth/gmail.send` (메일 발송)

### 4. 트리거 설정
```javascript
// setupTriggers() 함수를 실행하여 자동 트리거 설정
function setupTriggers() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  ScriptApp.newTrigger('onCheckboxChange')
    .timeBased()
    .everyMinutes(1)
    .create();
}
```

### 5. 시트명 확인
다음 시트명이 정확한지 확인:
- `설문지 응답 시트1`: 설문 응답이 저장되는 시트
- `문서`: PDF로 변환될 문서 템플릿 시트

## 💻 사용 방법

### 기본 사용 흐름
1. **설문 응답 확인**: A~I열의 데이터 검토
2. **금액 입력**: I열에 해당 금액 입력 (필수)
3. **처리 시작**: J열 체크박스 체크
4. **진행 상황 확인**: K, L열에서 처리 상태 실시간 모니터링

### 상태 표시
- **처리 중**: 🟡 노란색 배경
- **완료**: 🟢 초록색 배경 + 완료 메시지
- **실패**: 🔴 빨간색 배경 + 실패 사유

## 🔧 주요 함수 설명

### `onCheckboxChange(e)`
체크박스 변경을 감지하는 메인 트리거 함수

### `createCheckboxForNewResponse()`
새로운 응답 행에 체크박스 자동 생성

### `processDataAndGeneratePDF(rowIndex)`
데이터 매핑 및 PDF 생성 처리

### `sendEmailWithPDF(email, pdfBlob, rowIndex)`
PDF 첨부 메일 발송

### `validateRequiredData(rowData)`
필수 데이터 유효성 검증

## ⚠️ 주의사항

### 필수 데이터
- C열: 응답자 정보1 (필수)
- D열: 응답자 정보2 (필수)  
- E열: 응답자 이메일 (필수, 유효한 이메일 형식)
- F열: 응답자 정보3 (필수)
- I열: 금액 (필수, 숫자 형식)

### 오류 처리
- 필수 데이터 누락 시: "필수 데이터 누락" 오류
- 잘못된 이메일: "잘못된 이메일 주소" 오류
- PDF 생성 실패: 구체적 실패 사유 표시
- 메일 전송 실패: 구체적 실패 사유 표시

## 🔄 재실행 방법
- 오류 수정 후 체크박스를 다시 체크하면 재실행됩니다
- 중복 처리를 방지하는 로직이 포함되어 있습니다

## 📊 모니터링
- Apps Script 대시보드에서 실행 로그 확인
- 스프레드시트 K, L열에서 실시간 상태 확인
- 콘솔 로그로 상세 디버깅 정보 확인

## 🛠️ 문제 해결

### 자주 발생하는 문제
1. **트리거가 작동하지 않음**
   - `setupTriggers()` 함수 재실행
   - 권한 재승인 확인

2. **PDF 생성 실패**
   - 문서 시트 존재 여부 확인
   - Drive 용량 확인

3. **메일 발송 실패**
   - 이메일 주소 형식 확인
   - Gmail API 할당량 확인

### 테스트 방법
```javascript
// 테스트 함수 실행
function testFunction() {
  createCheckboxForNewResponse();
}
```

## 📈 성능 최적화
- 일일 API 할당량 내에서 동작
- 최대 10개 요청 동시 처리 가능
- 평균 처리 시간: 체크박스 체크 후 5분 이내

## 📞 지원
- 시스템 관련 문의는 관리자에게 연락
- 오류 발생 시 K, L열의 오류 메시지 확인 후 보고

---
**버전**: 1.0.0  
**최종 업데이트**: 2025년 9월