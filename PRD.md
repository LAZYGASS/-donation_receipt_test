# 구글 설문지 응답 자동 PDF 생성 및 메일 전송 시스템 PRD

## 1. 프로젝트 개요 (Project Overview)

### 1.1 프로젝트 배경 및 목적
본 프로젝트는 구글 설문지를 통해 수집된 응답 데이터를 자동으로 PDF 문서로 변환하고, 응답자에게 메일로 전송하는 완전 자동화 시스템을 구축하는 것을 목표로 합니다. 수동으로 처리해야 했던 반복적인 문서 생성 및 메일 발송 업무를 자동화하여 업무 효율성을 극대화하고 인적 오류를 최소화합니다.

### 1.2 예상 사용자 및 사용 시나리오
- **주요 사용자**: 설문 관리자, 운영팀
- **사용 시나리오**: 
  - 설문 응답이 접수되면 관리자가 검토 후 체크박스를 체크
  - 시스템이 자동으로 PDF를 생성하고 응답자에게 메일 발송
  - 진행 상황을 실시간으로 모니터링

### 1.3 성공 지표 정의
- **업무 효율성**: 문서 처리 시간 90% 단축
- **정확성**: 데이터 전송 오류율 0% 달성
- **자동화율**: 수동 개입 없이 95% 이상 자동 처리
- **응답 시간**: 체크박스 체크 후 5분 이내 메일 발송 완료

## 2. 기능 명세 (Functional Requirements)

### 2.1 핵심 기능별 상세 동작

#### 기능 1: 자동 체크박스 생성
**사용자 스토리**: 설문 응답이 새로 접수되면, 관리자가 별도 작업 없이도 해당 행에 체크박스가 자동으로 생성되어야 한다.

**상세 동작**:
- 설문지 응답 시트1에 새로운 행이 추가될 때 감지
- 해당 행의 J열에 체크박스 자동 삽입
- 체크박스 상태는 기본적으로 체크 해제 상태

**예외 처리**:
- 이미 체크박스가 존재하는 경우 중복 생성 방지
- 빈 행이 생성된 경우 체크박스 생성 제외

#### 기능 2: 트리거 기반 자동화 시작
**사용자 스토리**: 관리자가 I열에 금액을 입력하고 J열의 체크박스를 체크하면, 자동으로 PDF 생성 및 메일 발송 프로세스가 시작되어야 한다.

**상세 동작**:
1. J열 체크박스 상태 변경 감지
2. I열 금액 데이터 존재 여부 확인
3. 필수 데이터(C, D, E, F열) 유효성 검증
4. 조건 만족 시 자동화 프로세스 실행

**예외 처리**:
- I열에 금액이 없는 경우: "금액 정보 누락" 오류 메시지 출력
- 필수 데이터 누락 시: "필수 정보 부족" 오류 메시지 출력

#### 기능 3: 데이터 매핑 및 문서 생성
**사용자 스토리**: 설문 응답 데이터가 정확한 위치에 매핑되어 PDF 문서가 생성되어야 한다.

**데이터 매핑 규칙**:
```
문서 시트 ← 설문지 응답 시트1
C8 ← C열 (응답자 정보)
H8 ← D열 (응답자 정보)  
C9 ← F열 (응답자 정보)
J24 ← I열 (금액 정보)
```

**상세 동작**:
1. 해당 행의 데이터를 추출
2. 문서 시트의 지정된 셀에 데이터 입력
3. 문서 시트 기반으로 PDF 생성
4. 생성된 PDF를 지정 폴더에 저장

#### 기능 4: 메일 자동 발송
**사용자 스토리**: 생성된 PDF가 응답자의 이메일로 자동 발송되어야 한다.

**상세 동작**:
- E열에서 응답자 이메일 주소 추출
- 생성된 PDF 파일을 첨부
- 사전 정의된 메일 템플릿으로 메일 발송

### 2.2 상태 관리 시스템

#### K열: PDF 생성 상태
- **성공**: "PDF 저장 완료"
- **실패**: "PDF 저장 실패: [구체적 실패 사유]"
  - 예: "PDF 저장 실패: 드라이브 용량 부족"
  - 예: "PDF 저장 실패: 권한 없음"

#### L열: 메일 전송 상태  
- **성공**: "메일 전송 완료"
- **실패**: "메일 전송 실패: [구체적 실패 사유]"
  - 예: "메일 전송 실패: 잘못된 이메일 주소"
  - 예: "메일 전송 실패: 첨부파일 크기 초과"

## 3. 기술 명세 (Technical Requirements)

### 3.1 구글 앱스스크립트 함수 구조 설계

```javascript
// 메인 함수 구조
function onCheckboxChange(e) {
  // 체크박스 변경 감지 및 트리거 실행
}

function createCheckboxForNewResponse() {
  // 새 응답에 체크박스 자동 생성
}

function processDataAndGeneratePDF(rowIndex) {
  // 데이터 매핑 및 PDF 생성
}

function sendEmailWithPDF(email, pdfBlob, rowIndex) {
  // PDF 첨부 메일 발송
}

function updateStatus(rowIndex, column, status) {
  // 진행 상황 업데이트
}

function validateRequiredData(rowData) {
  // 필수 데이터 유효성 검증
}
```

### 3.2 트리거 설정 방법
- **트리거 타입**: onChange (시트 변경 감지)
- **트리거 범위**: 설문지 응답 시트1의 J열
- **실행 함수**: onCheckboxChange()
- **실행 조건**: 체크박스 상태가 false에서 true로 변경될 때

### 3.3 API 및 권한 요구사항
- **Google Sheets API**: 시트 데이터 읽기/쓰기
- **Google Drive API**: PDF 파일 저장
- **Gmail API**: 메일 발송
- **필요 권한**:
  - https://www.googleapis.com/auth/spreadsheets
  - https://www.googleapis.com/auth/drive.file
  - https://www.googleapis.com/auth/gmail.send

### 3.4 데이터 검증 로직
1. **필수 데이터 검증**: C, D, E, F, I열 데이터 존재 여부 확인
2. **이메일 형식 검증**: E열의 이메일 주소 유효성 검사
3. **금액 데이터 검증**: I열의 숫자 형식 확인
4. **중복 처리 방지**: 동일 행에 대한 중복 실행 방지

## 4. 사용자 인터페이스 (User Interface)

### 4.1 스프레드시트 레이아웃 설계

**설문지 응답 시트1 구조**:
```
A열: 타임스탬프
B열: 기타 응답 데이터
C열: 응답자 정보1 → 문서 C8
D열: 응답자 정보2 → 문서 H8  
E열: 응답자 이메일 (메일 발송용)
F열: 응답자 정보3 → 문서 C9
G-H열: 기타 응답 데이터
I열: 금액 → 문서 J24
J열: 체크박스 (트리거)
K열: PDF 저장 상태
L열: 메일 전송 상태
```

### 4.2 사용자 조작 방법
1. **설문 응답 확인**: A~I열의 데이터 검토
2. **금액 입력**: I열에 해당 금액 입력 (필수)
3. **처리 시작**: J열 체크박스 체크
4. **진행 상황 확인**: K, L열에서 처리 상태 실시간 모니터링

### 4.3 상태 표시 방법
- **처리 중**: 셀 배경색 노란색으로 표시
- **완료**: 셀 배경색 초록색, 완료 메시지 표시
- **실패**: 셀 배경색 빨간색, 실패 사유와 함께 표시

## 5. 데이터 플로우 (Data Flow)

### 5.1 전체 프로세스 플로우
```
설문 응답 접수
      ↓
설문지 응답 시트1에 데이터 저장
      ↓
J열에 체크박스 자동 생성
      ↓
관리자가 I열에 금액 입력
      ↓
관리자가 J열 체크박스 체크
      ↓
데이터 유효성 검증
      ↓
문서 시트에 데이터 매핑
      ↓
PDF 생성 및 드라이브 저장
      ↓
K열에 저장 상태 업데이트
      ↓
E열 이메일로 PDF 발송
      ↓
L열에 발송 상태 업데이트
```

### 5.2 에러 발생 시 처리 방안
- **부분 실패**: 성공한 단계는 유지, 실패 지점부터 재시작 가능
- **완전 실패**: 모든 상태를 초기화하고 오류 메시지 표시
- **복구 방법**: 오류 수정 후 체크박스 재체크로 재실행

## 6. 품질 보증 (Quality Assurance)

### 6.1 테스트 시나리오

#### 정상 시나리오 테스트
1. **기본 플로우**: 모든 데이터 정상 입력 → PDF 생성 → 메일 발송 성공
2. **다중 처리**: 여러 응답 동시 처리 시 정상 동작 확인
3. **재실행**: 체크박스 재체크 시 중복 처리 방지 확인

#### 예외 시나리오 테스트
1. **데이터 부족**: I열 금액 미입력 시 적절한 오류 메시지 출력
2. **잘못된 이메일**: 유효하지 않은 이메일 주소 처리
3. **권한 부족**: 드라이브 또는 메일 권한 없을 때 처리
4. **네트워크 오류**: API 호출 실패 시 재시도 로직 동작

### 6.2 성능 요구사항
- **응답 시간**: 체크박스 체크 후 5분 이내 전체 프로세스 완료
- **동시 처리**: 최대 10개 요청 동시 처리 가능
- **안정성**: 99.5% 이상의 성공률 보장

### 6.3 보안 고려사항
- **데이터 보호**: 개인정보 처리 시 암호화 적용
- **접근 제어**: 스크립트 실행 권한을 관리자로 제한
- **로그 관리**: 모든 처리 과정 로그 기록 및 주기적 삭제

## 7. 배포 및 운영 (Deployment & Operations)

### 7.1 배포 절차
1. **개발 환경 설정**: 구글 앱스스크립트 프로젝트 생성
2. **권한 설정**: 필요한 Google API 권한 승인
3. **트리거 등록**: onChange 트리거 설정
4. **테스트 실행**: 샘플 데이터로 전체 플로우 테스트
5. **운영 배포**: 실제 설문지와 연동

### 7.2 모니터링 방안
- **실행 로그**: Apps Script 대시보드에서 실행 이력 모니터링
- **오류 알림**: 실패 시 관리자에게 이메일 알림 발송
- **통계 데이터**: 일별/주별 처리 현황 리포트 생성

### 7.3 유지보수 계획
- **정기 점검**: 월 1회 시스템 상태 점검
- **백업**: 스크립트 코드 및 설정 정보 주간 백업
- **업데이트**: 구글 API 변경사항 반영 및 기능 개선

## 8. 일정 및 마일스톤 (Timeline & Milestones)

### 8.1 개발 단계별 일정 (총 3주)

#### 1주차: 기반 구조 개발
- 기본 트리거 및 데이터 매핑 로직 구현
- 체크박스 자동 생성 기능 개발
- 데이터 유효성 검증 로직 구현

#### 2주차: 핵심 기능 개발  
- PDF 생성 기능 구현
- 메일 발송 기능 구현
- 상태 관리 시스템 구현

#### 3주차: 테스트 및 배포
- 통합 테스트 실행
- 예외 상황 테스트 및 버그 수정
- 운영 환경 배포 및 모니터링 설정

### 8.2 주요 마일스톤
- **M1 (1주차 말)**: 기본 트리거 동작 완료
- **M2 (2주차 말)**: PDF 생성 및 메일 발송 기능 완료  
- **M3 (3주차 말)**: 전체 시스템 운영 준비 완료

### 8.3 리스크 요소 및 대응 방안

#### 기술적 리스크
- **Google API 제한**: 일일 할당량 초과 위험
  - 대응: 배치 처리 및 지연 처리 로직 구현
- **대용량 PDF 생성**: 메모리 부족 위험
  - 대응: 파일 크기 제한 및 압축 로직 적용

#### 운영 리스크  
- **사용자 실수**: 잘못된 체크박스 조작
  - 대응: 확인 다이얼로그 및 실행 취소 기능 구현
- **데이터 무결성**: 동시 처리 시 데이터 충돌
  - 대응: 락(Lock) 메커니즘 및 트랜잭션 처리 구현

## 9. 추가 고려사항

### 9.1 확장성 계획
- **다중 설문지 지원**: 여러 설문지 응답을 하나의 시스템에서 처리
- **템플릿 다양화**: 응답 내용에 따른 다양한 PDF 템플릿 지원
- **승인 워크플로우**: 관리자 승인 단계 추가 가능

### 9.2 사용자 경험 개선
- **진행률 표시**: 처리 진행률을 시각적으로 표시
- **알림 기능**: 처리 완료 시 관리자에게 알림
- **대시보드**: 전체 처리 현황을 한눈에 볼 수 있는 대시보드 제공

이상으로 구글 설문지 응답 자동 PDF 생성 및 메일 전송 시스템의 상세 PRD를 완료합니다. 본 문서를 기반으로 체계적이고 안정적인 자동화 시스템 구축이 가능합니다.